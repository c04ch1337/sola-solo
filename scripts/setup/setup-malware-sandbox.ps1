# Malware Sandbox Setup Script for Windows
# This script configures the malware sandbox environment for SOLA

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "  SOLA Malware Sandbox Setup" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""

# Check if running as Administrator
$isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
if (-not $isAdmin) {
    Write-Host "Warning: Not running as Administrator. Some features may not work correctly." -ForegroundColor Yellow
    Write-Host ""
}

# Create sandbox directory structure
Write-Host "Creating sandbox directory structure..." -ForegroundColor Green
$sandboxPath = ".\data\sandbox"
$playbooksPath = ".\playbooks"

if (-not (Test-Path $sandboxPath)) {
    New-Item -ItemType Directory -Force -Path $sandboxPath | Out-Null
    Write-Host "  Created: $sandboxPath" -ForegroundColor Gray
}
else {
    Write-Host "  Exists: $sandboxPath" -ForegroundColor Gray
}

if (-not (Test-Path $playbooksPath)) {
    New-Item -ItemType Directory -Force -Path $playbooksPath | Out-Null
    Write-Host "  Created: $playbooksPath" -ForegroundColor Gray
}
else {
    Write-Host "  Exists: $playbooksPath" -ForegroundColor Gray
}

Write-Host ""
Write-Host "Setup complete!" -ForegroundColor Green
Write-Host ""
Write-Host "Next steps:" -ForegroundColor White
Write-Host "1. Configure VirusTotal API key in .env (optional)" -ForegroundColor Gray
Write-Host "2. Build the project: cargo build --release" -ForegroundColor Gray
Write-Host "3. Start Phoenix: cargo run --bin pagi-sola-web" -ForegroundColor Gray
Write-Host "4. Test at: http://localhost:8888/api/sandbox/status" -ForegroundColor Gray
Write-Host ""
Write-Host "Security Notes:" -ForegroundColor Yellow
Write-Host "- NEVER set SANDBOX_ALLOW_EXECUTION=true in production" -ForegroundColor White
Write-Host "- The sandbox provides filesystem isolation only" -ForegroundColor White
Write-Host "- Always review analysis results before taking action" -ForegroundColor White
Write-Host ""
